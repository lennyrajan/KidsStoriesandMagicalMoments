<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kids Stories and Magical Moments</title>
  <meta name="description" content="Watch enchanting kids stories from the YouTube channel 'Kids Stories and Magical Moments'." />
  <meta name="keywords" content="kids stories, bedtime stories, magical moments, children's videos, fairy tales" />
  <meta name="author" content="Kids Stories and Magical Moments" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-200 text-gray-800 min-h-screen">

  <header class="text-center py-8">
    <h1 class="text-3xl md:text-5xl font-bold">Kids Stories and Magical Moments</h1>
    <p class="text-lg mt-2">Whimsical tales for little hearts</p>
  </header>

  <main class="px-4 md:px-12 lg:px-24">
    <div id="videoGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
  </main>

  <!-- Modal -->
  <div id="videoModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
    <div class="relative w-full max-w-3xl aspect-video">
      <iframe id="modalIframe" class="w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      <button onclick="closeModal()" class="absolute top-2 right-2 bg-white rounded-full p-2 text-lg leading-none">‚ùå</button>
    </div>
  </div>

  <script>
    async function fetchVideos() {
      try {
        const res = await fetch("/.netlify/functions/fetchVideos");
        if (!res.ok) throw new Error('Network response was not ok');
        const videos = await res.json();
        console.log("Videos fetched:", videos);

        const grid = document.getElementById("videoGrid");
        grid.innerHTML = ""; // clear existing content

        videos.forEach(video => {
          // Extract videoId
          const videoId = video.id?.videoId || (typeof video.id === 'string' ? video.id : null);
          if (!videoId) {
            console.warn("Skipping video with missing videoId:", video);
            return;
          }

          // Extract thumbnail URL with fallback
          const thumbs = video.snippet?.thumbnails || {};
          const thumbUrl = thumbs.high?.url || thumbs.medium?.url || thumbs.default?.url || "";

          if (!thumbUrl) {
            console.warn("No thumbnail URL found for video:", video.snippet.title);
          }

          // Create video card element
          const container = document.createElement("div");
          container.className = "rounded-xl overflow-hidden shadow-lg bg-white hover:scale-105 transition-all duration-300 cursor-pointer";

          container.innerHTML = `
            <img class="w-full" src="${thumbUrl}" alt="${video.snippet.title}" />
            <div class="p-4">
              <h2 class="text-sm font-semibold">${video.snippet.title}</h2>
            </div>
          `;

          // On click, open modal and play video
          container.onclick = () => {
            const modal = document.getElementById("videoModal");
            const iframe = document.getElementById("modalIframe");
            iframe.src = \`https://www.youtube.com/embed/\${videoId}?autoplay=1\`;
            modal.classList.remove("hidden");
          };

          grid.appendChild(container);
        });
      } catch (error) {
        console.error("Error fetching or displaying videos:", error);
      }
    }

    function closeModal() {
      const modal = document.getElementById("videoModal");
      const iframe = document.getElementById("modalIframe");
      iframe.src = "";  // stop video playback
      modal.classList.add("hidden");
    }

    window.onload = fetchVideos;
  </script>

</body>
</html>
